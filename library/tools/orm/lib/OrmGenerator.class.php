<?php

class OrmGenerator {
	public function __construct(){}
	static function getClassName($table) {
		return Lambda::map(_hx_explode("_", strtolower($table)), array(new _hx_lambda(array(&$table), "OrmGenerator_0"), 'execute'))->join("");
	}
	static function make($basePath) {
		$basePath = rtrim(str_replace("\\", "/", $basePath), "/") . "/";
		$modelFolder = $basePath . "models/";
		if(!is_dir($modelFolder)) {
			@mkdir($modelFolder, 493);
		}
		if(!is_dir($modelFolder . "autogenerated")) {
			@mkdir($modelFolder . "autogenerated", 493);
		}
		$managerFolder = $basePath . "managers/";
		if(!is_dir($managerFolder)) {
			@mkdir($managerFolder, 493);
		}
		if(!is_dir($managerFolder . "autogenerated")) {
			@mkdir($managerFolder . "autogenerated", 493);
		}
		$tables = haquery_server_db_HaqDb::$connection->getTables();
		{
			$_g = 0;
			while($_g < $tables->length) {
				$table = $tables[$_g];
				++$_g;
				$className = OrmGenerator::getClassName($table);
				OrmModelGenerator::make($table, $basePath, "models." . $className, "models.autogenerated." . $className, "managers." . $className . "Manager");
				OrmManagerGenerator::make($table, $basePath, "models." . $className, "managers." . $className . "Manager", "managers.autogenerated." . $className . "Manager");
				unset($table,$className);
			}
		}
	}
	function __toString() { return 'OrmGenerator'; }
}
function OrmGenerator_0(&$table, $w) {
	{
		return OrmTools::capitalize($w);
	}
}
